<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#f4f1ea" />
  <title>Family Day Planner</title>
  <link rel="icon" href="data:,">
  <link rel="manifest" href="./manifest.json" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
  <div class="buildBadge" id="buildBadge"></div>

    <div class="brand">
      <div class="brandMark">FDP</div>
      <div class="brandText">
        <div class="brandTitle">Family Day Planner</div>
        <div class="brandSub" id="headerSub">—</div>
      </div>
    </div>
    <div class="topbarActions">
      <button class="btn btnGhost" id="btnExport">Export</button>
      <button class="btn btnGhost" id="btnSignOut">Sign out</button>
    </div>
  </header>

  <main class="main" id="main">
    <section class="view" id="viewEvening">
      <div class="card">
        <div class="cardHead">
          <div>
            <h2>Evening</h2>
            <div class="muted">Prepare tomorrow’s plan with a quick guided flow.</div>
          </div>
          <div class="row">
            <button class="btn" id="btnOpenWizard">Prepare for the Day Ahead</button>
            <button class="btn btnSecondary" id="btnQuickEditTomorrow" disabled>Quick edit</button>
          </div>
        </div>

        <div id="tomorrowEmpty" class="empty">No plan for tomorrow yet.</div>

        <div id="tomorrowWrap" class="hidden">
          <div class="timelineTop">
            <div class="timelineTitle">Tomorrow</div>
            <div class="muted" id="tomorrowMeta">—</div>
          </div>
          <div id="tomorrowTimeline" class="timeline"></div>
        </div>
      </div>
    </section>

    <section class="view hidden" id="viewToday">
      <div class="grid2">
        <div class="card">
          <div class="cardHead">
            <div>
              <h2>Today</h2>
              <div class="muted">Schedule regenerates based on wake/nap actuals and edits.</div>
            </div>
            <div class="row">
              <button class="btn btnSecondary" id="btnEditToday">Edit plan</button>
            </div>
          </div>

          <div class="logGrid">
            <div class="logRow">
              <div class="logLabel">Actual wake</div>
              <div class="logControls">
                <button class="btn btnTiny" id="btnWakeNow">Set now</button>
                <input class="input inputTime" id="wakeTime" type="time" />
              </div>
            </div>

            <div class="logRow">
              <div class="logLabel">Nap 1</div>
              <div class="logControls">
                <label class="toggle"><input type="checkbox" id="nap1On"> <span>Track</span></label>
                <input class="input inputTime" id="nap1Start" type="time" disabled />
                <span class="muted">to</span>
                <input class="input inputTime" id="nap1End" type="time" disabled />
              </div>
            </div>

            <div class="logRow">
              <div class="logLabel">Nap 2</div>
              <div class="logControls">
                <label class="toggle"><input type="checkbox" id="nap2On"> <span>Track</span></label>
                <input class="input inputTime" id="nap2Start" type="time" disabled />
                <span class="muted">to</span>
                <input class="input inputTime" id="nap2End" type="time" disabled />
              </div>
            </div>

            <div class="logRow">
              <div class="logLabel">Bedtime (tracking)</div>
              <div class="logControls">
                <input class="input inputTime" id="bedtime" type="time" />
              </div>
            </div>

            <div class="logRow logRowStack">
              <div class="logLabel">Overnight notes (tracking)</div>
              <textarea class="textarea" id="overnightNotes" placeholder="Anything notable overnight…"></textarea>
            </div>
          </div>

          <div class="timelineTop">
            <div class="timelineTitle">Timeline</div>
            <div class="muted" id="todayMeta">—</div>
          </div>
          <div id="todayTimeline" class="timeline"></div>
        </div>

        <div class="card">
          <div class="cardHead">
            <div>
              <h2>Tasks for Today</h2>
              <div class="muted">Keep it short. Add anything else in Tasks.</div>
            </div>
          </div>
          <div id="todayTasks" class="tasks"></div>
        </div>
      </div>
    </section>

    <section class="view hidden" id="viewTasks">
      <div class="card">
        <div class="cardHead">
          <div>
            <h2>Tasks</h2>
            <div class="muted">Persistent master list. Assign to Today or Tomorrow anytime.</div>
          </div>
        </div>
        <div class="row">
          <input class="input" id="taskInput" placeholder="Add a task…" />
          <button class="btn" id="btnAddTask">Add</button>
        </div>

        <div class="split">
          <div>
            <div class="sectionTitle">Inbox</div>
            <div id="tasksOpen" class="tasks"></div>
          </div>
          <div>
            <div class="sectionTitle">Completed</div>
            <div id="tasksDone" class="tasks"></div>
          </div>
        </div>
      </div>
    </section>

    <section class="view hidden" id="viewHistory">
      <div class="card">
        <div class="cardHead">
          <div>
            <h2>History</h2>
            <div class="muted">Tap a date to view details.</div>
          </div>
        </div>
        <div id="historyList" class="history"></div>
      </div>

      <div class="card hidden" id="historyDetail">
        <div class="cardHead">
          <div>
            <h2 id="histTitle">—</h2>
            <div class="muted" id="histMeta">—</div>
          </div>
          <button class="btn btnSecondary" id="btnCloseHist">Close</button>
        </div>
        <pre class="pre" id="histBody"></pre>
      </div>
    </section>

    <section class="view hidden" id="viewSettings">
      <div class="card">
        <div class="cardHead">
          <div>
            <h2>Settings</h2>
            <div class="muted">Defaults that affect tomorrow forecasting + today regeneration.</div>
          </div>
        </div>

        <div class="form">
          <label class="field"><span>Default wake time</span><input class="input inputTime" id="setWake" type="time"></label>
          <label class="field"><span>Breakfast duration (min)</span><input class="input" id="setBreakfast" type="number" min="5" step="5"></label>
          <label class="field"><span>Lunch duration (min)</span><input class="input" id="setLunch" type="number" min="5" step="5"></label>
          <label class="field"><span>Dinner duration (min)</span><input class="input" id="setDinner" type="number" min="5" step="5"></label>
          <label class="field"><span>Nap routine duration (min)</span><input class="input" id="setNapRoutine" type="number" min="5" step="5"></label>
          <label class="field"><span>Bedtime routine duration (min)</span><input class="input" id="setBedRoutine" type="number" min="5" step="5"></label>
          <label class="field"><span>Nap 1 forecast duration (min)</span><input class="input" id="setNap1" type="number" min="20" step="5"></label>
          <label class="field"><span>Nap 2 forecast duration (min)</span><input class="input" id="setNap2" type="number" min="20" step="5"></label>

          <div class="field wide">
            <div class="sectionTitle">Wake windows (hours)</div>
            <div class="row wrap">
              <label class="chip">WW1 min <input class="input tiny" id="ww1Min" type="number" step="0.25"></label>
              <label class="chip">WW1 max <input class="input tiny" id="ww1Max" type="number" step="0.25"></label>
              <label class="chip">WW2 min <input class="input tiny" id="ww2Min" type="number" step="0.25"></label>
              <label class="chip">WW2 max <input class="input tiny" id="ww2Max" type="number" step="0.25"></label>
              <label class="chip">WW3 min <input class="input tiny" id="ww3Min" type="number" step="0.25"></label>
              <label class="chip">WW3 max <input class="input tiny" id="ww3Max" type="number" step="0.25"></label>
            </div>
          </div>

          <div class="field wide">
            <div class="sectionTitle">Google Calendar export (Apps Script)</div>
            <div class="muted small">App sends day blocks → Apps Script writes to a dedicated calendar.</div>
            <label class="field"><span>Apps Script Web App URL</span><input class="input" id="gcalUrl" placeholder="https://script.google.com/macros/s/.../exec"></label>
            <label class="field"><span>Calendar ID</span><input class="input" id="gcalCalId" placeholder="...@group.calendar.google.com"></label>
            <label class="field"><span>Shared API key</span><input class="input" id="gcalKey" placeholder="paste-your-shared-key"></label>
          </div>
        </div>

        <div class="row">
          <button class="btn" id="btnSaveSettings">Save settings</button>
        </div>

        <div class="divider"></div>
        <div class="sectionTitle">Household</div>
        <div class="muted small">Invite others with the join code.</div>
        <div class="row wrap">
          <div class="pill" id="hhName">—</div>
          <div class="pill mono" id="hhCode">Join code: —</div>
          <button class="btn btnSecondary" id="btnCopyCode">Copy join code</button>
        </div>
      </div>
    </section>
  </main>

  <nav class="tabbar">
    <button class="tab active" data-tab="Evening">☾<span>Evening</span></button>
    <button class="tab" data-tab="Today">☀︎<span>Today</span></button>
    <button class="tab" data-tab="Tasks">✓<span>Tasks</span></button>
    <button class="tab" data-tab="History">⟲<span>History</span></button>
    <button class="tab" data-tab="Settings">⚙︎<span>Settings</span></button>
  </nav>

  <!-- AUTH -->
  <div class="modal hidden" id="authModal" aria-hidden="true">
    <div class="scrim"></div>
    <div class="panel" role="dialog" aria-modal="true">
      <div class="panelHead">
        <h3>Sign in</h3>
      </div>
      <div class="panelBody">
        <div class="notice">
          <div class="noticeTitle">Private household</div>
          <div class="noticeBody">Sign in with email/password. If you’re new, create an account, then create or join the household.</div>
        </div>
        <label class="field"><span>Email</span><input class="input" id="authEmail" type="email" placeholder="you@example.com"></label>
        <label class="field"><span>Password</span><input class="input" id="authPass" type="password" placeholder="••••••••"></label>
        <div class="row">
          <button class="btn" id="btnSignIn">Sign in</button>
          <button class="btn btnSecondary" id="btnSignUp">Create account</button>
        </div>

        <div class="divider"></div>

        <div id="hhGate" class="hidden">
          <div class="sectionTitle">Household setup</div>
          <div class="muted small">Create a household (first person) or join with a code.</div>

          <label class="field"><span>Household name</span><input class="input" id="newHhName" placeholder="e.g., Vega‑Payne household"></label>
          <button class="btn" id="btnCreateHh">Create household</button>

          <div class="divider"></div>

          <label class="field"><span>Join code</span><input class="input" id="joinCode" placeholder="paste join code"></label>
          <button class="btn btnSecondary" id="btnJoinHh">Join household</button>
        </div>
      </div>
    </div>
  </div>

  <!-- WIZARD -->
  <div class="modal hidden" id="wizardModal" aria-hidden="true">
    <div class="scrim" id="wizardScrim"></div>
    <div class="panel wide" role="dialog" aria-modal="true">
      <div class="panelHead">
        <div>
          <h3>Prepare for the Day Ahead</h3>
          <div class="muted small" id="wizardMeta">Autosaves as you go.</div>
        </div>
        <button class="btn btnGhost" id="btnCloseWizard">Close</button>
      </div>

      <div class="stepper" id="stepper"></div>

      <div class="panelBody">
        <section class="step" data-step="1">
          <h4>1) Today’s focus tasks</h4>
          <div class="muted">These are the tasks you previously chose from your brain dump for this day. Edit them in Step 3.</div>
          <div id="focusSummary" class="tasks"></div>
          <div class="row">
            <button class="btn btnSecondary" id="btnJumpFocus">Edit focus tasks (Step 3)</button>
          </div>
        </section>

        <section class="step hidden" data-step="2">
          <h4>2) Brain dump → Tasks</h4>
          <div class="muted">One per line. We’ll create tasks in your master list.</div>
          <textarea class="textarea" id="brainDump" placeholder="Example:
Pack daycare bag
Pay electric bill
Text nanny about Friday"></textarea>
          <div class="row">
            <button class="btn btnSecondary" id="btnConvert">Convert to tasks</button>
            <div class="muted small" id="bdStatus">—</div>
          </div>
        </section>

        <section class="step hidden" data-step="3">
          <h4>3) Choose tasks to focus on tomorrow</h4>
          <div class="muted">Pick a small set. You can adjust later.</div>
          <div id="focusPicker" class="tasks"></div>
        </section>

        <section class="step hidden" data-step="4">
          <h4>4) Tomorrow constraints</h4>

          <div class="sectionTitle">Availability blocks</div>
          <div class="muted small">Julio/Kristyn blocks = <b>unavailable</b>. Nanny blocks = <b>working</b> (only if “Nanny working?” is on). Kayden blocks = <b>available</b>. Kayden can help with routines but <b>never naps</b>.</div>

          <div class="availGrid">
            <div class="availCol">
              <div class="availTitle">Julio unavailable</div>
              <div id="blkJulio" class="blkList"></div>
              <button class="btn btnTiny" data-add="julio">+ Add block</button>
            </div>
            <div class="availCol">
              <div class="availTitle">Kristyn unavailable</div>
              <div id="blkKristyn" class="blkList"></div>
              <button class="btn btnTiny" data-add="kristyn">+ Add block</button>
            </div>
            <div class="availCol">
              <div class="availTitle">Nanny working?</div>
              <label class="toggle"><input type="checkbox" id="nannyOn"> <span>Yes</span></label>
              <div id="blkNanny" class="blkList"></div>
              <button class="btn btnTiny" data-add="nanny">+ Add block</button>
            </div>
            <div class="availCol">
              <div class="availTitle">Kayden available</div>
              <div id="blkKayden" class="blkList"></div>
              <button class="btn btnTiny" data-add="kayden">+ Add block</button>
            </div>
          </div>

          <div class="divider"></div>

          <div class="sectionTitle">Bedtime caregiver (Kristyn or Julio only)</div>
          <div class="row wrap">
            <label class="pillRadio"><input type="radio" name="bedCare" value="Kristyn"> Kristyn</label>
            <label class="pillRadio"><input type="radio" name="bedCare" value="Julio"> Julio</label>
          </div>

          <div class="divider"></div>

          <div class="sectionTitle">Appointments</div>
          <div id="apptList" class="apptList"></div>
          <button class="btn btnTiny" id="btnAddAppt">+ Add appointment</button>
          <div class="muted small">Appointments only affect schedule if overlapping scheduled blocks.</div>
        </section>

        <section class="step hidden" data-step="5">
          <h4>5) Preview tomorrow schedule + Save</h4>
          <div id="warnings" class="notice hidden"></div>
          <div id="wizardPreview" class="timeline"></div>
          <div class="row">
            <button class="btn" id="btnSavePlan">Save</button>
            <button class="btn btnSecondary" id="btnBackTo4">Back</button>
            <div class="muted small" id="saveStatus">—</div>
          </div>
        </section>

        <div class="wizardNav">
          <button class="btn btnSecondary" id="btnPrev">Back</button>
          <button class="btn" id="btnNext">Next</button>
        </div>
      </div>
    </div>
  </div>

  <!-- QUICK EDIT -->
  <div class="modal hidden" id="quickModal" aria-hidden="true">
    <div class="scrim" id="quickScrim"></div>
    <div class="panel wide" role="dialog" aria-modal="true">
      <div class="panelHead">
        <div>
          <h3 id="quickTitle">Quick edit</h3>
          <div class="muted small">Adjust availability + appointments without redoing everything.</div>
        </div>
        <button class="btn btnGhost" id="btnCloseQuick">Close</button>
      </div>
      <div class="panelBody">
        <div id="quickBody"></div>
        <div class="row">
          <button class="btn" id="btnSaveQuick">Save changes</button>
          <div class="muted small" id="quickStatus">—</div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast hidden" id="toast"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./app.js"></script>
</body>
</html>
