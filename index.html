<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#F3F1EA" />
  <title>Family Day Planner</title>

  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./icons/icon-192.png" />
  <style>
    :root{
      --bg: #F3F1EA;           /* warm off-white */
      --bg2:#EEF2ED;           /* light sage wash */
      --card:#FFFFFF;
      --ink:#1D2320;
      --muted:#5B665F;
      --hair:#D9D6CC;
      --sage:#6D7F72;
      --clay:#A4735A;
      --sand:#C9B79E;
      --accent:#2E6B55;        /* deep sage */
      --accent2:#7B8B6A;       /* soft sage */
      --warn:#9B5A3C;
      --ok:#2E6B55;
      --shadow: 0 12px 30px rgba(0,0,0,.08);
      --shadow2: 0 6px 16px rgba(0,0,0,.06);
      --radius: 18px;
      --radius2: 12px;
      --pad: 16px;
      --max: 1080px;
      --hourPx: 78px;          /* timeline scale */
      --tabH: 74px;
      --safeBottom: env(safe-area-inset-bottom, 0px);
    }

    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 600px at 20% -10%, var(--bg2), transparent 70%),
                  radial-gradient(900px 500px at 90% 10%, #F6F2EA, transparent 60%),
                  linear-gradient(180deg, var(--bg), #F7F6F0 55%, #F4F2EA);
      color: var(--ink);
    }

    /* App shell */
    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 14px 14px calc(var(--tabH) + var(--safeBottom) + 22px);
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 12px 6px 10px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .logo{
      width:38px; height:38px;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(46,107,85,.18), rgba(164,115,90,.14));
      border: 1px solid rgba(46,107,85,.22);
      display:grid;
      place-items:center;
      box-shadow: var(--shadow2);
    }
    .logo svg{ width: 22px; height:22px; opacity:.9; }
    .title{
      display:flex; flex-direction:column; line-height:1.1;
    }
    .title strong{ font-size: 14px; letter-spacing:.2px; }
    .title span{ font-size: 12px; color: var(--muted); margin-top:2px; }

    .pill{
      font-size:12px;
      color: var(--muted);
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.65);
      padding: 8px 10px;
      border-radius: 999px;
      display:flex;
      align-items:center;
      gap: 8px;
      backdrop-filter: blur(6px);
    }

    /* Cards */
    .grid{
      display:grid;
      gap: 14px;
    }
    .card{
      background: rgba(255,255,255,.82);
      border: 1px solid rgba(0,0,0,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .card .hd{
      padding: 14px 14px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
    }
    .card .hd h2{
      margin:0;
      font-size: 14px;
      letter-spacing: .2px;
    }
    .card .hd p{
      margin: 6px 0 0;
      font-size: 12px;
      color: var(--muted);
      line-height:1.35;
    }
    .card .bd{ padding: 0 14px 14px; }

    .row{ display:flex; gap: 10px; flex-wrap:wrap; }
    .row > * { flex: 1 1 auto; }

    /* Buttons */
    button, .btn{
      font-family: inherit;
      border: 1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.88);
      color: var(--ink);
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 13px;
      cursor:pointer;
      box-shadow: 0 1px 0 rgba(0,0,0,.04);
      transition: transform .06s ease, background .12s ease, border-color .12s ease;
    }
    button:active{ transform: translateY(1px); }
    .primary{
      background: linear-gradient(180deg, rgba(46,107,85,.90), rgba(46,107,85,.80));
      color: white;
      border-color: rgba(46,107,85,.5);
    }
    .ghost{
      background: rgba(255,255,255,.6);
    }
    .danger{
      background: rgba(155,90,60,.10);
      border-color: rgba(155,90,60,.35);
      color: #6d2f18;
    }
    .mini{ padding: 8px 10px; font-size:12px; border-radius: 11px; }

    /* Inputs */
    input, textarea, select{
      width:100%;
      border: 1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.86);
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 13px;
      color: var(--ink);
      outline: none;
    }
    textarea{ min-height: 92px; resize: vertical; }
    label{ font-size: 12px; color: var(--muted); display:block; margin: 10px 0 6px; }

    .hint{ font-size: 12px; color: var(--muted); line-height:1.35; }
    .divider{ height:1px; background: rgba(0,0,0,.07); margin: 12px 0; }

    /* Tabs */
    .tabs{
      position: fixed;
      left: 0; right: 0; bottom: 0;
      height: calc(var(--tabH) + var(--safeBottom));
      padding-bottom: var(--safeBottom);
      background: rgba(247,246,240,.78);
      border-top: 1px solid rgba(0,0,0,.09);
      backdrop-filter: blur(10px);
      display:flex;
      justify-content:center;
      z-index: 30;
    }
    .tabs .inner{
      max-width: var(--max);
      width: 100%;
      display:flex;
      gap: 8px;
      padding: 10px 12px 12px;
      justify-content:space-between;
    }
    .tab{
      flex: 1 1 0;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap: 5px;
      padding: 8px 6px;
      border-radius: 16px;
      border: 1px solid transparent;
      color: var(--muted);
      font-size: 11px;
      user-select:none;
    }
    .tab svg{ width: 18px; height: 18px; opacity:.9; }
    .tab.active{
      color: var(--ink);
      background: rgba(255,255,255,.72);
      border-color: rgba(0,0,0,.08);
      box-shadow: 0 10px 24px rgba(0,0,0,.08);
    }

    /* Timeline */
    .twoCol{
      display:grid;
      grid-template-columns: 1.35fr .95fr;
      gap: 14px;
      align-items: start;
    }
    @media (max-width: 880px){
      .twoCol{ grid-template-columns: 1fr; }
    }

    .timeline{
      position:relative;
      height: calc(var(--hourPx) * 12); /* 12 hours shown by default; we can scroll for full day */
      min-height: 520px;
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(0,0,0,.08);
      border-radius: var(--radius);
      overflow:auto;
    }
    .tlGrid{
      position: relative;
      min-height: calc(var(--hourPx) * 24);
      padding-left: 62px;
      padding-right: 12px;
    }
    .hourLine{
      position:absolute;
      left: 0; right: 0;
      height: 0;
      border-top: 1px solid rgba(0,0,0,.06);
    }
    .hourLabel{
      position:absolute;
      left: 10px;
      transform: translateY(-8px);
      font-size: 11px;
      color: var(--muted);
      width: 46px;
      text-align:right;
    }
    .block{
      position:absolute;
      border-radius: 14px;
      padding: 10px 10px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(46,107,85,.10);
      box-shadow: 0 6px 14px rgba(0,0,0,.06);
      overflow:hidden;
      min-width: 140px;
    }
    .block .t{
      font-size: 12px;
      font-weight: 650;
      letter-spacing:.2px;
      margin:0;
      line-height:1.25;
    }
    .block .m{
      margin: 6px 0 0;
      font-size: 11px;
      color: rgba(29,35,32,.78);
      line-height:1.25;
    }
    .block.appt{ background: rgba(164,115,90,.12); border-color: rgba(164,115,90,.30); }
    .block.nap{ background: rgba(123,139,106,.14); border-color: rgba(123,139,106,.35); }
    .block.warn{ background: rgba(155,90,60,.12); border-color: rgba(155,90,60,.35); }
    .laneWrap{ position:absolute; top:0; left:62px; right:12px; bottom:0; }

    .badge{
      display:inline-flex;
      gap:6px;
      align-items:center;
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.75);
      color: var(--muted);
    }
    .badge.ok{ border-color: rgba(46,107,85,.30); color: var(--ok); background: rgba(46,107,85,.08);}
    .badge.warn{ border-color: rgba(155,90,60,.35); color: #7a3a22; background: rgba(155,90,60,.08);}

    /* Lists */
    .list{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .item{
      display:flex;
      align-items:flex-start;
      gap: 10px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.08);
      background: rgba(255,255,255,.72);
    }
    .item input[type="checkbox"]{
      width: 18px; height: 18px; margin-top:2px;
      accent-color: var(--accent);
    }
    .item .txt{
      flex:1;
      font-size: 13px;
      line-height:1.25;
    }
    .item .sub{
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }

    /* Modal / wizard */
    .modal{
      position: fixed;
      inset:0;
      background: rgba(0,0,0,.38);
      display:none;
      align-items:flex-end;
      justify-content:center;
      z-index: 50;
      padding: 14px;
      padding-bottom: calc(14px + var(--safeBottom));
    }
    .modal.open{ display:flex; }
    .sheet{
      width: 100%;
      max-width: 820px;
      max-height: 84vh;
      background: rgba(250,249,245,.96);
      border: 1px solid rgba(255,255,255,.35);
      border-radius: 22px;
      box-shadow: 0 28px 70px rgba(0,0,0,.25);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .sheet .top{
      padding: 14px 14px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(0,0,0,.08);
      background: linear-gradient(180deg, rgba(255,255,255,.72), rgba(255,255,255,.52));
    }
    .sheet .top h3{
      margin:0;
      font-size: 14px;
      letter-spacing:.2px;
    }
    .sheet .top .sub{
      margin-top: 4px;
      font-size: 12px;
      color: var(--muted);
    }
    .sheet .mid{
      padding: 12px 14px 14px;
      overflow:auto;
    }

    .stepper{
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
      padding: 0 14px 10px;
      border-bottom: 1px solid rgba(0,0,0,.06);
      background: rgba(255,255,255,.55);
    }
    .step{
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.68);
      font-size: 12px;
      color: var(--muted);
      cursor:pointer;
      user-select:none;
    }
    .step.active{
      background: rgba(46,107,85,.10);
      border-color: rgba(46,107,85,.25);
      color: var(--ink);
      font-weight: 650;
    }

    .sheet .bot{
      padding: 12px 14px;
      border-top: 1px solid rgba(0,0,0,.08);
      background: rgba(255,255,255,.58);
      display:flex;
      justify-content:space-between;
      gap: 10px;
    }
    .sheet .bot .left, .sheet .bot .right{ display:flex; gap: 10px; align-items:center; }
    .sheet .bot .right{ margin-left:auto; }

    .muteline{ font-size: 12px; color: var(--muted); }

    .auth{
      position: fixed;
      inset: 0;
      background: radial-gradient(900px 550px at 20% 0%, var(--bg2), transparent 70%),
                  linear-gradient(180deg, var(--bg), #F7F6F0 55%, #F4F2EA);
      display:none;
      z-index: 60;
      padding: 18px 14px calc(20px + var(--safeBottom));
      overflow:auto;
    }
    .auth.open{ display:block; }
    .auth .box{
      max-width: 520px;
      margin: 0 auto;
      padding: 16px;
    }
    .auth .box .card{ padding: 14px; }
    .kicker{ font-size: 12px; color: var(--muted); margin: 10px 0 0; }

    .toast{
      position: fixed;
      left: 14px;
      right: 14px;
      bottom: calc(var(--tabH) + var(--safeBottom) + 14px);
      max-width: 760px;
      margin: 0 auto;
      background: rgba(29,35,32,.92);
      color: white;
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 13px;
      display:none;
      z-index: 80;
      box-shadow: 0 18px 40px rgba(0,0,0,.22);
    }
    .toast.show{ display:block; }

    .sr{ position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden; }
  </style>
</head>
<body>
  <div class="auth" id="auth">
    <div class="box">
      <div class="brand" style="padding: 12px 6px 14px;">
        <div class="logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M7 19c4.8-1.2 7.6-4.2 9.2-9.7.2-.8-.7-1.6-1.5-1.3C9.1 10 6.2 12.8 5 17.7c-.2.8.7 1.6 1.5 1.3Z" stroke="currentColor" stroke-width="1.7" />
            <path d="M12.3 8.4c1.2-.5 2.5-.9 3.8-1.1" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="title">
          <strong>Family Day Planner</strong>
          <span>Private family intranet</span>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <div>
            <h2>Sign in</h2>
            <p>Use email + password. Your account must be linked to the household in Supabase.</p>
          </div>
        </div>
        <div class="bd">
          <label>Email</label>
          <input id="authEmail" type="email" placeholder="name@example.com" autocomplete="email" />
          <label>Password</label>
          <input id="authPass" type="password" placeholder="••••••••" autocomplete="current-password" />
          <div class="row" style="margin-top:12px;">
            <button class="primary" id="btnSignIn">Sign in</button>
            <button class="ghost" id="btnSignUp">Create account</button>
          </div>
          <p class="kicker" id="authMsg"></p>
        </div>
      </div>

      <p class="kicker" style="margin-top:14px;">
        Tip: After creating accounts, link each user to the household by inserting rows into <code>household_members</code> in Supabase.
      </p>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <div class="wrap" id="app">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M7 19c4.8-1.2 7.6-4.2 9.2-9.7.2-.8-.7-1.6-1.5-1.3C9.1 10 6.2 12.8 5 17.7c-.2.8.7 1.6 1.5 1.3Z" stroke="currentColor" stroke-width="1.7" />
            <path d="M12.3 8.4c1.2-.5 2.5-.9 3.8-1.1" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="title">
          <strong>Family Day Planner</strong>
          <span id="subhead">Loading…</span>
        </div>
      </div>
      <div class="pill">
        <span id="pillUser">—</span>
        <button class="mini ghost" id="btnSignOut" title="Sign out">Sign out</button>
      </div>
    </header>

    <main id="view"></main>
  </div>

  <nav class="tabs" aria-label="Primary">
    <div class="inner" id="tabs">
      <!-- tabs injected -->
    </div>
  </nav>

  <!-- Evening Wizard Modal -->
  <div class="modal" id="wizardModal" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="wizTitle">
      <div class="top">
        <div>
          <h3 id="wizTitle">Prepare for the Day Ahead</h3>
          <div class="sub" id="wizSub">Tomorrow</div>
        </div>
        <div class="right">
          <button class="mini ghost" id="wizClose">Close</button>
        </div>
      </div>

      <div class="stepper" id="wizSteps"></div>

      <div class="mid" id="wizBody"></div>

      <div class="bot">
        <div class="left">
          <span class="muteline" id="wizStatus">Autosaving…</span>
        </div>
        <div class="right">
          <button class="ghost" id="wizBack">Back</button>
          <button class="primary" id="wizNext">Next</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Edit Modal -->
  <div class="modal" id="quickEditModal" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="qeTitle">
      <div class="top">
        <div>
          <h3 id="qeTitle">Quick edit</h3>
          <div class="sub" id="qeSub">Availability + appointments</div>
        </div>
        <div class="right">
          <button class="mini ghost" id="qeClose">Close</button>
        </div>
      </div>
      <div class="mid" id="qeBody"></div>
      <div class="bot">
        <div class="left">
          <span class="muteline" id="qeStatus">Edits apply immediately.</span>
        </div>
        <div class="right">
          <button class="primary" id="qeSave">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Supabase (UMD/global) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./app.js"></script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('./service-worker.js'));
    }
  </script>
</body>
</html>
